(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PWebrtcStar = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PWebrtcStar=(()=>{var wo=Object.create;var gt=Object.defineProperty;var bo=Object.getOwnPropertyDescriptor;var vo=Object.getOwnPropertyNames;var xo=Object.getPrototypeOf,Eo=Object.prototype.hasOwnProperty;var G=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),O=(r,e)=>{for(var t in e)gt(r,t,{get:e[t],enumerable:!0})},on=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of vo(e))!Eo.call(r,s)&&s!==t&&gt(r,s,{get:()=>e[s],enumerable:!(n=bo(e,s))||n.enumerable});return r};var N=(r,e,t)=>(t=r!=null?wo(xo(r)):{},on(e||!r||!r.__esModule?gt(t,"default",{value:r,enumerable:!0}):t,r)),Co=r=>on(gt({},"__esModule",{value:!0}),r);var cn=G((Tc,an)=>{var Ee=1e3,Ce=Ee*60,Ae=Ce*60,ue=Ae*24,Ao=ue*7,To=ue*365.25;an.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return So(r);if(t==="number"&&isFinite(r))return e.long?Io(r):ko(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function So(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*To;case"weeks":case"week":case"w":return t*Ao;case"days":case"day":case"d":return t*ue;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ae;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ce;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ee;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function ko(r){var e=Math.abs(r);return e>=ue?Math.round(r/ue)+"d":e>=Ae?Math.round(r/Ae)+"h":e>=Ce?Math.round(r/Ce)+"m":e>=Ee?Math.round(r/Ee)+"s":r+"ms"}function Io(r){var e=Math.abs(r);return e>=ue?yt(r,e,ue,"day"):e>=Ae?yt(r,e,Ae,"hour"):e>=Ce?yt(r,e,Ce,"minute"):e>=Ee?yt(r,e,Ee,"second"):r+" ms"}function yt(r,e,t,n){var s=e>=t*1.5;return Math.round(r/t)+" "+n+(s?"s":"")}});var hn=G((Sc,ln)=>{function _o(r){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=s,t.enabled=i,t.humanize=cn(),t.destroy=g,Object.keys(r).forEach(c=>{t[c]=r[c]}),t.names=[],t.skips=[],t.formatters={};function e(c){let h=0;for(let d=0;d<c.length;d++)h=(h<<5)-h+c.charCodeAt(d),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(c){let h,d=null,y,p;function f(...b){if(!f.enabled)return;let A=f,_=Number(new Date),U=_-(h||_);A.diff=U,A.prev=h,A.curr=_,h=_,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let R=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(V,B)=>{if(V==="%%")return"%";R++;let q=t.formatters[B];if(typeof q=="function"){let xe=b[R];V=q.call(A,xe),b.splice(R,1),R--}return V}),t.formatArgs.call(A,b),(A.log||t.log).apply(A,b)}return f.namespace=c,f.useColors=t.useColors(),f.color=t.selectColor(c),f.extend=n,f.destroy=t.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(y!==t.namespaces&&(y=t.namespaces,p=t.enabled(c)),p),set:b=>{d=b}}),typeof t.init=="function"&&t.init(f),f}function n(c,h){let d=t(this.namespace+(typeof h>"u"?":":h)+c);return d.log=this.log,d}function s(c){t.save(c),t.namespaces=c,t.names=[],t.skips=[];let h,d=(typeof c=="string"?c:"").split(/[\s,]+/),y=d.length;for(h=0;h<y;h++)d[h]&&(c=d[h].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.slice(1)+"$")):t.names.push(new RegExp("^"+c+"$")))}function o(){let c=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),c}function i(c){if(c[c.length-1]==="*")return!0;let h,d;for(h=0,d=t.skips.length;h<d;h++)if(t.skips[h].test(c))return!1;for(h=0,d=t.names.length;h<d;h++)if(t.names[h].test(c))return!0;return!1}function a(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function l(c){return c instanceof Error?c.stack||c.message:c}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}ln.exports=_o});var un=G((F,wt)=>{F.formatArgs=Po;F.save=Lo;F.load=Oo;F.useColors=Ro;F.storage=No();F.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();F.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Ro(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Po(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+wt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),r.splice(n,0,e)}F.log=console.debug||console.log||(()=>{});function Lo(r){try{r?F.storage.setItem("debug",r):F.storage.removeItem("debug")}catch{}}function Oo(){let r;try{r=F.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function No(){try{return localStorage}catch{}}wt.exports=hn()(F);var{formatters:Bo}=wt.exports;Bo.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Se=G((Uc,bn)=>{"use strict";function wn(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function ei(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return wn(r,t)}catch{t.message=r.message,t.stack=r.stack;let s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(r)),wn(new s,t)}}bn.exports=ei});var zn=G((Bl,qn)=>{qn.exports=Cr;var Vn=128,Yi=127,Gi=~Yi,Xi=Math.pow(2,31);function Cr(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw Cr.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=Xi;)e[t++]=r&255|Vn,r/=128;for(;r&Gi;)e[t++]=r&255|Vn,r>>>=7;return e[t]=r|0,Cr.bytes=t-n+1,e}});var jn=G((Fl,Wn)=>{Wn.exports=Ar;var Ji=128,$n=127;function Ar(r,n){var t=0,n=n||0,s=0,o=n,i,a=r.length;do{if(o>=a||s>49)throw Ar.bytes=0,new RangeError("Could not decode varint");i=r[o++],t+=s<28?(i&$n)<<s:(i&$n)*Math.pow(2,s),s+=7}while(i>=Ji);return Ar.bytes=o-n,t}});var Kn=G((Dl,Hn)=>{var Qi=Math.pow(2,7),Zi=Math.pow(2,14),ea=Math.pow(2,21),ta=Math.pow(2,28),ra=Math.pow(2,35),na=Math.pow(2,42),sa=Math.pow(2,49),oa=Math.pow(2,56),ia=Math.pow(2,63);Hn.exports=function(r){return r<Qi?1:r<Zi?2:r<ea?3:r<ta?4:r<ra?5:r<na?6:r<sa?7:r<oa?8:r<ia?9:10}});var St=G((Ml,Yn)=>{Yn.exports={encode:zn(),decode:jn(),encodingLength:Kn()}});var $t=G((Uf,zs)=>{"use strict";function oc(r){let e=new Uint8Array(r),t=0;if(r>0)if(r>65536)for(;t<r;)t+65536>r?(crypto.getRandomValues(e.subarray(t,t+(r-t))),t+=r-t):(crypto.getRandomValues(e.subarray(t,t+65536)),t+=65536);else crypto.getRandomValues(e);return e}zs.exports=oc});var Yr=G((jf,Kr)=>{"use strict";var cc=(r,e)=>Math.floor(Math.random()*(e-r+1)+r),Hs=()=>{let r=new Error("Delay aborted");return r.name="AbortError",r},Ks=({clearTimeout:r,setTimeout:e,willResolve:t})=>(n,{value:s,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(Hs());let i,a,l,g=r||clearTimeout,c=()=>{g(i),l(Hs())},h=()=>{o&&o.removeEventListener("abort",c)},d=new Promise((y,p)=>{a=()=>{h(),t?y(s):p(s)},l=p,i=(e||setTimeout)(a,n)});return o&&o.addEventListener("abort",c,{once:!0}),d.clear=()=>{g(i),i=null,a()},d},Ys=r=>{let e=Ks({...r,willResolve:!0});return e.reject=Ks({...r,willResolve:!1}),e.range=(t,n,s)=>e(cc(t,n),s),e},Hr=Ys();Hr.createWithTimers=Ys;Kr.exports=Hr;Kr.exports.default=Hr});var Cc={};O(Cc,{webRTCStar:()=>Ec});var z=N(un(),1);var er={};O(er,{base58btc:()=>k,base58flickr:()=>qo});function Fo(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),i=o.charCodeAt(0);if(t[i]!==255)throw new TypeError(o+" is ambiguous");t[i]=s}var a=r.length,l=r.charAt(0),g=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var f=0,b=0,A=0,_=p.length;A!==_&&p[A]===0;)A++,f++;for(var U=(_-A)*c+1>>>0,R=new Uint8Array(U);A!==_;){for(var j=p[A],V=0,B=U-1;(j!==0||V<b)&&B!==-1;B--,V++)j+=256*R[B]>>>0,R[B]=j%a>>>0,j=j/a>>>0;if(j!==0)throw new Error("Non-zero carry");b=V,A++}for(var q=U-b;q!==U&&R[q]===0;)q++;for(var xe=l.repeat(f);q<U;++q)xe+=r.charAt(R[q]);return xe}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var f=0;if(p[f]!==" "){for(var b=0,A=0;p[f]===l;)b++,f++;for(var _=(p.length-f)*g+1>>>0,U=new Uint8Array(_);p[f];){var R=t[p.charCodeAt(f)];if(R===255)return;for(var j=0,V=_-1;(R!==0||j<A)&&V!==-1;V--,j++)R+=a*U[V]>>>0,U[V]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");A=j,f++}if(p[f]!==" "){for(var B=_-A;B!==_&&U[B]===0;)B++;for(var q=new Uint8Array(b+(_-B)),xe=b;B!==_;)q[xe++]=U[B++];return q}}}function y(p){var f=d(p);if(f)return f;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:y}}var Do=Fo,Mo=Do,fn=Mo;var Ic=new Uint8Array(0);var dn=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Q=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var pn=r=>new TextEncoder().encode(r),mn=r=>new TextDecoder().decode(r);var Xt=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Jt=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return yn(this,e)}},Qt=class{constructor(e){this.decoders=e}or(e){return yn(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},yn=(r,e)=>new Qt({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),Zt=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Xt(e,t,n),this.decoder=new Jt(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Te=({name:r,prefix:e,encode:t,decode:n})=>new Zt(r,e,t,n),ne=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=fn(t,e);return Te({prefix:r,name:e,encode:n,decode:o=>Q(s(o))})},Uo=(r,e,t,n)=>{let s={};for(let c=0;c<e.length;++c)s[e[c]]=c;let o=r.length;for(;r[o-1]==="=";)--o;let i=new Uint8Array(o*t/8|0),a=0,l=0,g=0;for(let c=0;c<o;++c){let h=s[r[c]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<t|h,a+=t,a>=8&&(a-=8,i[g++]=255&l>>a)}if(a>=t||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return i},Vo=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,o="",i=0,a=0;for(let l=0;l<r.length;++l)for(a=a<<8|r[l],i+=8;i>t;)i-=t,o+=e[s&a>>i];if(i&&(o+=e[s&a<<t-i]),n)for(;o.length*t&7;)o+="=";return o},T=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Te({prefix:e,name:r,encode(s){return Vo(s,n,t)},decode(s){return Uo(s,n,t,r)}});var k=ne({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),qo=ne({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var tr={};O(tr,{base32:()=>H,base32hex:()=>jo,base32hexpad:()=>Ko,base32hexpadupper:()=>Yo,base32hexupper:()=>Ho,base32pad:()=>$o,base32padupper:()=>Wo,base32upper:()=>zo,base32z:()=>Go});var H=T({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),zo=T({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$o=T({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Wo=T({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jo=T({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ho=T({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ko=T({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Yo=T({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Go=T({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var nr={};O(nr,{base64:()=>rr,base64pad:()=>Xo,base64url:()=>Jo,base64urlpad:()=>Qo});var rr=T({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Xo=T({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jo=T({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Qo=T({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});z.default.formatters.b=r=>r==null?"undefined":k.baseEncode(r);z.default.formatters.t=r=>r==null?"undefined":H.baseEncode(r);z.default.formatters.m=r=>r==null?"undefined":rr.baseEncode(r);z.default.formatters.p=r=>r==null?"undefined":r.toString();z.default.formatters.c=r=>r==null?"undefined":r.toString();z.default.formatters.k=r=>r==null?"undefined":r.toString();function Zo(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function $(r){let e=Zo(`${r}:trace`);return z.default.enabled(`${r}:trace`)&&z.default.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=(0,z.default)(`${r}:trace`)),Object.assign((0,z.default)(r),{error:(0,z.default)(`${r}:error`),trace:e})}var mt=N(Se(),1);var se=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function vn(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function sr(r,e,t){let n=t??{},s=vn(r);async function*o(){let i,a=()=>{i?.()};for(e.addEventListener("abort",a);;){let l;try{if(e.aborted){let{abortMessage:c,abortCode:h}=n;throw new se(c,h)}let g=new Promise((c,h)=>{i=()=>{let{abortMessage:d,abortCode:y}=n;h(new se(d,y))}});l=await Promise.race([g,s.next()]),i=null}catch(g){e.removeEventListener("abort",a);let c=g.type==="aborted"&&e.aborted;if(c&&n.onAbort!=null&&n.onAbort(r),typeof s.return=="function")try{let h=s.return();h instanceof Promise&&h.catch(d=>{n.onReturnError!=null&&n.onReturnError(d)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(c&&n.returnOnAbort===!0)return;throw g}if(l.done===!0)break;yield l.value}e.removeEventListener("abort",a)}return o()}var bt=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,s){return this.readAtomically(()=>{let o=0,i=0,a=this.peekChar();if(a===void 0)return;let l=a==="0",g=2**(8*s)-1;for(;;){let c=this.readAtomically(()=>{let h=this.readChar();if(h===void 0)return;let d=Number.parseInt(h,e);if(!Number.isNaN(d))return d});if(c===void 0)break;if(o*=e,o+=c,o>g||(i+=1,t!==void 0&&i>t))return}if(i!==0)return!n&&l&&i>1?void 0:o})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let s=n*2;if(n<t.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return t[s]=i[0],t[s+1]=i[1],t[s+2]=i[2],t[s+3]=i[3],[s+4,!0]}let o=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(o===void 0)return[s,!1];t[s]=o>>8,t[s+1]=o&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,s]=e(t);if(n===16)return t;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let o=new Uint8Array(14),i=16-(n+2),[a]=e(o.subarray(0,i));return t.set(o.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var xn=45,ti=15,ke=new bt;function or(r){if(!(r.length>ti))return ke.new(r).parseWith(()=>ke.readIPv4Addr())}function ir(r){if(!(r.length>xn))return ke.new(r).parseWith(()=>ke.readIPv6Addr())}function vt(r){if(!(r.length>xn))return ke.new(r).parseWith(()=>ke.readIPAddr())}function En(r){return!!or(r)}function Cn(r){return!!ir(r)}function xt(r){return!!vt(r)}var ar={};O(ar,{identity:()=>ri});var ri=Te({prefix:"\0",name:"identity",encode:r=>mn(r),decode:r=>pn(r)});var cr={};O(cr,{base2:()=>ni});var ni=T({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var lr={};O(lr,{base8:()=>si});var si=T({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var hr={};O(hr,{base10:()=>oi});var oi=ne({prefix:"9",name:"base10",alphabet:"0123456789"});var ur={};O(ur,{base16:()=>ii,base16upper:()=>ai});var ii=T({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ai=T({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fr={};O(fr,{base36:()=>ci,base36upper:()=>li});var ci=ne({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),li=ne({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var dr={};O(dr,{base256emoji:()=>pi});var An=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),hi=An.reduce((r,e,t)=>(r[t]=e,r),[]),ui=An.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function fi(r){return r.reduce((e,t)=>(e+=hi[t],e),"")}function di(r){let e=[];for(let t of r){let n=ui[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var pi=Te({prefix:"\u{1F680}",name:"base256emoji",encode:fi,decode:di});var yr={};O(yr,{sha256:()=>Ct,sha512:()=>Oi});var mi=kn,Tn=128,gi=127,yi=~gi,wi=Math.pow(2,31);function kn(r,e,t){e=e||[],t=t||0;for(var n=t;r>=wi;)e[t++]=r&255|Tn,r/=128;for(;r&yi;)e[t++]=r&255|Tn,r>>>=7;return e[t]=r|0,kn.bytes=t-n+1,e}var bi=pr,vi=128,Sn=127;function pr(r,n){var t=0,n=n||0,s=0,o=n,i,a=r.length;do{if(o>=a)throw pr.bytes=0,new RangeError("Could not decode varint");i=r[o++],t+=s<28?(i&Sn)<<s:(i&Sn)*Math.pow(2,s),s+=7}while(i>=vi);return pr.bytes=o-n,t}var xi=Math.pow(2,7),Ei=Math.pow(2,14),Ci=Math.pow(2,21),Ai=Math.pow(2,28),Ti=Math.pow(2,35),Si=Math.pow(2,42),ki=Math.pow(2,49),Ii=Math.pow(2,56),_i=Math.pow(2,63),Ri=function(r){return r<xi?1:r<Ei?2:r<Ci?3:r<Ai?4:r<Ti?5:r<Si?6:r<ki?7:r<Ii?8:r<_i?9:10},Pi={encode:mi,decode:bi,encodingLength:Ri},Li=Pi,ze=Li;var $e=(r,e=0)=>[ze.decode(r,e),ze.decode.bytes],Ie=(r,e,t=0)=>(ze.encode(r,e,t),e),_e=r=>ze.encodingLength(r);var oe=(r,e)=>{let t=e.byteLength,n=_e(r),s=n+_e(t),o=new Uint8Array(s+t);return Ie(r,o,0),Ie(t,o,n),o.set(e,s),new Re(r,t,e,o)},fe=r=>{let e=Q(r),[t,n]=$e(e),[s,o]=$e(e.subarray(n)),i=e.subarray(n+o);if(i.byteLength!==s)throw new Error("Incorrect length");return new Re(t,s,i,e)},In=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&dn(r.bytes,t.bytes)}},Re=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var gr=({name:r,code:e,encode:t})=>new mr(r,e,t),mr=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?oe(this.code,t):t.then(n=>oe(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Rn=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Ct=gr({name:"sha2-256",code:18,encode:Rn("SHA-256")}),Oi=gr({name:"sha2-512",code:19,encode:Rn("SHA-512")});var wr={};O(wr,{identity:()=>At});var Pn=0,Ni="identity",Ln=Q,Bi=r=>oe(Pn,Ln(r)),At={code:Pn,name:Ni,encode:Ln,digest:Bi};var hl=new TextEncoder,ul=new TextDecoder;var On=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return Ui(t,br(r),e||k.encoder);default:return Vi(t,br(r),e||H.encoder)}};var Nn=new WeakMap,br=r=>{let e=Nn.get(r);if(e==null){let t=new Map;return Nn.set(r,t),t}return e},v=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==We)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==qi)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return v.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=oe(e,t);return v.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return v.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&In(e.multihash,n.multihash)}toString(e){return On(this,e)}toJSON(){return{"/":On(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof v)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:o,bytes:i}=t;return new v(n,s,o,i||Bn(n,s,o.bytes))}else if(t[zi]===!0){let{version:n,multihash:s,code:o}=t,i=fe(s);return v.create(n,o,i)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==We)throw new Error(`Version 0 CID must use dag-pb (code: ${We}) block encoding`);return new v(e,t,n,n.bytes)}case 1:{let s=Bn(e,t,n.bytes);return new v(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return v.create(0,We,e)}static createV1(e,t){return v.create(1,e,t)}static decode(e){let[t,n]=v.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=v.inspectBytes(e),n=t.size-t.multihashSize,s=Q(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let o=s.subarray(t.multihashSize-t.digestSize),i=new Re(t.multihashCode,t.digestSize,o,s);return[t.version===0?v.createV0(i):v.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[h,d]=$e(e.subarray(t));return t+=d,h},s=n(),o=We;if(s===18?(s=0,t=0):o=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let i=t,a=n(),l=n(),g=t+l,c=g-i;return{version:s,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:g}}static parse(e,t){let[n,s]=Mi(e,t),o=v.decode(s);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return br(o).set(n,e),o}},Mi=(r,e)=>{switch(r[0]){case"Q":{let t=e||k;return[k.prefix,t.decode(`${k.prefix}${r}`)]}case k.prefix:{let t=e||k;return[k.prefix,t.decode(r)]}case H.prefix:{let t=e||H;return[H.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Ui=(r,e,t)=>{let{prefix:n}=t;if(n!==k.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let o=t.encode(r).slice(1);return e.set(n,o),o}else return s},Vi=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let o=t.encode(r);return e.set(n,o),o}else return s},We=112,qi=18,Bn=(r,e,t)=>{let n=_e(r),s=n+_e(e),o=new Uint8Array(s+t.byteLength);return Ie(r,o,0),Ie(e,o,n),o.set(t,s),o},zi=Symbol.for("@ipld/js-cid/CID");var ie={...ar,...cr,...lr,...hr,...ur,...tr,...fr,...er,...nr,...dr},xl={...yr,...wr};function pe(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function je(r=0){return globalThis.Buffer?.allocUnsafe!=null?pe(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Dn(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Fn=Dn("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),vr=Dn("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=je(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),$i={utf8:Fn,"utf-8":Fn,hex:ie.base16,latin1:vr,ascii:vr,binary:vr,...ie},Tt=$i;function S(r,e="utf8"){let t=Tt[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var Mn=En,Wi=Cn,xr=function(r){let e=0;if(r=r.toString().trim(),Mn(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(Wi(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let o=Mn(t[n]),i;o&&(i=xr(t[n]),t[n]=S(i.slice(0,2),"base16")),i!=null&&++n<8&&t.splice(n,0,S(i.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let o=[n,1];for(n=9-t.length;n>0;n--)o.push("0");t.splice.apply(t,o)}let s=new Uint8Array(e+16);for(n=0;n<t.length;n++){let o=parseInt(t[n],16);s[e++]=o>>8&255,s[e++]=o&255}return s}throw new Error("invalid ip address")},Un=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let s=[];for(let o=0;o<t;o++)s.push(r[e+o]);return s.join(".")}if(t===16){let s=[];for(let o=0;o<t;o+=2)s.push(n.getUint16(e+o).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var He={},Er={},Hi=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];Hi.forEach(r=>{let e=Ki(...r);Er[e.code]=e,He[e.name]=e});function Ki(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function E(r){if(typeof r=="number"){if(Er[r]!=null)return Er[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(He[r]!=null)return He[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var J=N(St(),1);function kt(r,e="utf8"){let t=Tt[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?pe(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function X(r,e){e==null&&(e=r.reduce((s,o)=>s+o.length,0));let t=je(e),n=0;for(let s of r)t.set(s,n),n+=s.length;return pe(t)}var Jl=parseInt("0xFFFF",16),Ql=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);var _h=E("ip4"),Rh=E("ip6"),Ph=E("ipcidr");function ts(r,e){switch(E(r).code){case 4:case 41:return fa(e);case 42:return Zn(e);case 6:case 273:case 33:case 132:return ns(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Zn(e);case 421:return ga(e);case 444:return es(e);case 445:return es(e);case 466:return ma(e);default:return S(e,"base16")}}function rs(r,e){switch(E(r).code){case 4:return Jn(e);case 41:return Jn(e);case 42:return Qn(e);case 6:case 273:case 33:case 132:return Sr(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Qn(e);case 421:return da(e);case 444:return ya(e);case 445:return wa(e);case 466:return pa(e);default:return kt(e,"base16")}}var Tr=Object.values(ie).map(r=>r.decoder),ua=function(){let r=Tr[0].or(Tr[1]);return Tr.slice(2).forEach(e=>r=r.or(e)),r}();function Jn(r){if(!xt(r))throw new Error("invalid ip address");return xr(r)}function fa(r){let e=Un(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!xt(e))throw new Error("invalid ip address");return e}function Sr(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function ns(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function Qn(r){let e=kt(r),t=Uint8Array.from(J.default.encode(e.length));return X([t,e],t.length+e.length)}function Zn(r){let e=J.default.decode(r);if(r=r.slice(J.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return S(r)}function da(r){let e;r[0]==="Q"||r[0]==="1"?e=fe(k.decode(`z${r}`)).bytes:e=v.parse(r).multihash.bytes;let t=Uint8Array.from(J.default.encode(e.length));return X([t,e],t.length+e.length)}function pa(r){let e=ua.decode(r),t=Uint8Array.from(J.default.encode(e.length));return X([t,e],t.length+e.length)}function ma(r){let e=J.default.decode(r),t=r.slice(J.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+S(t,"base64url")}function ga(r){let e=J.default.decode(r),t=r.slice(J.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return S(t,"base58btc")}function ya(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=H.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=Sr(n);return X([t,s],t.length+s.length)}function wa(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=H.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=Sr(n);return X([t,s],t.length+s.length)}function es(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=S(e,"base32"),s=ns(t);return`${n}:${s}`}var Pe=N(St(),1);function ba(r){let e=[],t=r.split("/").slice(1);if(t.length===1&&t[0]==="")return[];for(let n=0;n<t.length;n++){let s=t[n],o=E(s);if(o.size===0){e.push([s]);continue}if(n++,n>=t.length)throw os("invalid address: "+r);if(o.path===!0){e.push([s,Pr(t.slice(n).join("/"))]);break}e.push([s,t[n]])}return e}function va(r){let e=[];return r.map(t=>{let n=Rt(t);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),Pr(e.join("/"))}function xa(r){return r.map(e=>{Array.isArray(e)||(e=[e]);let t=Rt(e);return e.length>1?[t.code,rs(t.code,e[1])]:[t.code]})}function kr(r){return r.map(e=>{let t=Rt(e);return e[1]!=null?[t.code,ts(t.code,e[1])]:[t.code]})}function Ir(r){return _t(X(r.map(e=>{let t=Rt(e),n=Uint8Array.from(Pe.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=X([n,e[1]])),n})))}function _r(r,e){return r.size>0?r.size/8:r.size===0?0:Pe.default.decode(e)+(Pe.default.decode.bytes??0)}function It(r){let e=[],t=0;for(;t<r.length;){let n=Pe.default.decode(r,t),s=Pe.default.decode.bytes??0,o=E(n),i=_r(o,r.slice(t+s));if(i===0){e.push([n]),t+=s;continue}let a=r.slice(t+s,t+s+i);if(t+=i+s,t>r.length)throw os("Invalid address Uint8Array: "+S(r,"base16"));e.push([n,a])}return e}function Rr(r){let e=It(r),t=kr(e);return va(t)}function Ea(r){r=Pr(r);let e=ba(r),t=xa(e);return Ir(t)}function ss(r){return Ea(r)}function _t(r){let e=Ca(r);if(e!=null)throw e;return Uint8Array.from(r)}function Ca(r){try{It(r)}catch(e){return e}}function Pr(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function os(r){return new Error("Error parsing address: "+r)}function Rt(r){return E(r[0])}var Lr=N(St(),1);var Ke=class extends Error{constructor(e,t,n){super(e),this.code=t,this.name=n?.name??"CodeError",this.props=n??{}}};function Le(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var Z=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Oe=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ye,Ge,Xe,ce,is,Ta=Symbol.for("nodejs.util.inspect.custom"),Sa=[E("dns").code,E("dns4").code,E("dns6").code,E("dnsaddr").code],ka=new Map,as=Symbol.for("@multiformats/js-multiaddr/multiaddr");function cs(r){return ls(r)?r.protos().some(e=>e.resolvable):!1}function ls(r){return!!r?.[as]}var ee=class{constructor(e){if(Ye.set(this,void 0),Ge.set(this,void 0),Xe.set(this,void 0),ce.set(this,void 0),this[is]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=_t(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=ss(e)}else if(ls(e))this.bytes=_t(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Z(this,Ye,"f")==null&&Oe(this,Ye,Rr(this.bytes),"f"),Z(this,Ye,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,s,o="",i=E("tcp"),a=E("udp"),l=E("ip4"),g=E("ip6"),c=E("dns6"),h=E("ip6zone");for(let[y,p]of this.stringTuples())y===h.code&&(o=`%${p??""}`),Sa.includes(y)&&(t=i.name,s=443,n=`${p??""}${o}`,e=y===c.code?6:4),(y===i.code||y===a.code)&&(t=E(y).name,s=parseInt(p??"")),(y===l.code||y===g.code)&&(t=E(y).name,n=`${p??""}${o}`,e=y===g.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},E(e)))}protoCodes(){let e=[],t=this.bytes,n=0;for(;n<t.length;){let s=Lr.default.decode(t,n),o=Lr.default.decode.bytes??0,i=E(s),a=_r(i,t.slice(n+o));n+=a+o,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Z(this,Ge,"f")==null&&Oe(this,Ge,It(this.bytes),"f"),Z(this,Ge,"f")}stringTuples(){return Z(this,Xe,"f")==null&&Oe(this,Xe,kr(this.tuples()),"f"),Z(this,Xe,"f")}encapsulate(e){return e=new ee(e),new ee(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ee(n.slice(0,s))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new ee(Ir(t.slice(0,n)));return this}getPeerId(){try{let t=this.stringTuples().filter(n=>n[0]===He.ipfs.code).pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?S(k.decode(`z${n}`),"base58btc"):S(v.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){if(Z(this,ce,"f")===void 0)try{Oe(this,ce,this.stringTuples().filter(e=>E(e[0]).path===!0)[0][1],"f"),Z(this,ce,"f")==null&&Oe(this,ce,null,"f")}catch{Oe(this,ce,null,"f")}return Z(this,ce,"f")}equals(e){return Le(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(o=>o.resolvable);if(t==null)return[this];let n=ka.get(t.name);if(n==null)throw new Ke(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(o=>new ee(o))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(Ye=new WeakMap,Ge=new WeakMap,Xe=new WeakMap,ce=new WeakMap,is=as,Ta)](){return`Multiaddr(${Rr(this.bytes)})`}};function ae(r){return new ee(r)}var Ia=u("dns4"),_a=u("dns6"),Ra=u("dnsaddr"),me=I(u("dns"),Ra,Ia,_a),Pt=I(u("ip4"),u("ip6")),Be=I(m(Pt,u("tcp")),m(me,u("tcp"))),Lt=m(Pt,u("udp")),Pa=m(Lt,u("utp")),La=m(Lt,u("quic")),Oa=m(Lt,u("quic-v1")),Je=I(m(Be,u("ws")),m(me,u("ws"))),Qe=I(m(Be,u("wss")),m(me,u("wss")),m(Be,u("tls"),u("ws")),m(me,u("tls"),u("ws"))),Or=I(m(Be,u("http")),m(Pt,u("http")),m(me,u("http"))),Nr=I(m(Be,u("https")),m(Pt,u("https")),m(me,u("https"))),hs=m(Lt,u("webrtc-direct"),u("certhash")),ds=I(m(hs,u("p2p")),hs),us=m(Oa,u("webtransport"),u("certhash"),u("certhash")),ps=I(m(us,u("p2p")),us),Ot=I(m(Je,u("p2p-webrtc-star"),u("p2p")),m(Qe,u("p2p-webrtc-star"),u("p2p")),m(Je,u("p2p-webrtc-star")),m(Qe,u("p2p-webrtc-star"))),Zh=I(m(Je,u("p2p-websocket-star"),u("p2p")),m(Qe,u("p2p-websocket-star"),u("p2p")),m(Je,u("p2p-websocket-star")),m(Qe,u("p2p-websocket-star"))),ms=I(m(Or,u("p2p-webrtc-direct"),u("p2p")),m(Nr,u("p2p-webrtc-direct"),u("p2p")),m(Or,u("p2p-webrtc-direct")),m(Nr,u("p2p-webrtc-direct"))),Fe=I(Je,Qe,Or,Nr,Ot,ms,Be,Pa,La,me,ds,ps),eu=I(m(Fe,u("p2p-stardust"),u("p2p")),m(Fe,u("p2p-stardust"))),le=I(m(Fe,u("p2p")),Ot,ms,ds,ps,u("p2p")),fs=I(m(le,u("p2p-circuit"),le),m(le,u("p2p-circuit")),m(u("p2p-circuit"),le),m(Fe,u("p2p-circuit")),m(u("p2p-circuit"),Fe),u("p2p-circuit")),gs=()=>I(m(fs,gs),fs),Ne=gs(),tu=I(m(Ne,le,Ne),m(le,Ne),m(Ne,le),Ne,le);var ru=I(m(Ne,u("webrtc")),m(Fe,u("webrtc")),u("webrtc"));function ys(r){function e(t){let n;try{n=ae(t)}catch{return!1}let s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return e}function m(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(s=>(n=typeof s=="function"?s().partialMatch(t):s.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:ys(e),partialMatch:e}}function I(...r){function e(n){let s=null;return r.some(o=>{let i=typeof o=="function"?o().partialMatch(n):o.partialMatch(n);return i!=null?(s=i,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:ys(e),partialMatch:e}}function u(r){let e=r;function t(s){let o;try{o=ae(s)}catch{return!1}let i=o.protoNames();return i.length===1&&i[0]===e}function n(s){return s.length===0?null:s[0]===e?s.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var io=N(Se(),1);var K=Object.create(null);K.open="0";K.close="1";K.ping="2";K.pong="3";K.message="4";K.upgrade="5";K.noop="6";var Ze=Object.create(null);Object.keys(K).forEach(r=>{Ze[K[r]]=r});var ws={type:"error",data:"parser error"};var Ba=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Fa=typeof ArrayBuffer=="function",Da=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Ma=({type:r,data:e},t,n)=>Ba&&e instanceof Blob?t?n(e):bs(e,n):Fa&&(e instanceof ArrayBuffer||Da(e))?t?n(e):bs(new Blob([e]),n):n(K[r]+(e||"")),bs=(r,e)=>{let t=new FileReader;return t.onload=function(){let n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},Nt=Ma;var vs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",et=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<vs.length;r++)et[vs.charCodeAt(r)]=r;var xs=r=>{let e=r.length*.75,t=r.length,n,s=0,o,i,a,l;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);let g=new ArrayBuffer(e),c=new Uint8Array(g);for(n=0;n<t;n+=4)o=et[r.charCodeAt(n)],i=et[r.charCodeAt(n+1)],a=et[r.charCodeAt(n+2)],l=et[r.charCodeAt(n+3)],c[s++]=o<<2|i>>4,c[s++]=(i&15)<<4|a>>2,c[s++]=(a&3)<<6|l&63;return g};var Ua=typeof ArrayBuffer=="function",Va=(r,e)=>{if(typeof r!="string")return{type:"message",data:Es(r,e)};let t=r.charAt(0);return t==="b"?{type:"message",data:qa(r.substring(1),e)}:Ze[t]?r.length>1?{type:Ze[t],data:r.substring(1)}:{type:Ze[t]}:ws},qa=(r,e)=>{if(Ua){let t=xs(r);return Es(t,e)}else return{base64:!0,data:r}},Es=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},Bt=Va;var Cs=String.fromCharCode(30),As=(r,e)=>{let t=r.length,n=new Array(t),s=0;r.forEach((o,i)=>{Nt(o,!1,a=>{n[i]=a,++s===t&&e(n.join(Cs))})})},Ts=(r,e)=>{let t=r.split(Cs),n=[];for(let s=0;s<t.length;s++){let o=Bt(t[s],e);if(n.push(o),o.type==="error")break}return n},Br=4;function C(r){if(r)return za(r)}function za(r){for(var e in C.prototype)r[e]=C.prototype[e];return r}C.prototype.on=C.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};C.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};C.prototype.off=C.prototype.removeListener=C.prototype.removeAllListeners=C.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,s=0;s<t.length;s++)if(n=t[s],n===e||n.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+r],this};C.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,s=t.length;n<s;++n)t[n].apply(this,e)}return this};C.prototype.emitReserved=C.prototype.emit;C.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};C.prototype.hasListeners=function(r){return!!this.listeners(r).length};var P=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Ft(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}var $a=P.setTimeout,Wa=P.clearTimeout;function te(r,e){e.useNativeTimers?(r.setTimeoutFn=$a.bind(P),r.clearTimeoutFn=Wa.bind(P)):(r.setTimeoutFn=P.setTimeout.bind(P),r.clearTimeoutFn=P.clearTimeout.bind(P))}var ja=1.33;function Ss(r){return typeof r=="string"?Ha(r):Math.ceil((r.byteLength||r.size)*ja)}function Ha(r){let e=0,t=0;for(let n=0,s=r.length;n<s;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}var Fr=class extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}},ge=class extends C{constructor(e){super(),this.writable=!1,te(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Fr(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=Bt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}};var Rs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Dr=64,Ka={},ks=0,Dt=0,Is;function _s(r){let e="";do e=Rs[r%Dr]+e,r=Math.floor(r/Dr);while(r>0);return e}function Mt(){let r=_s(+new Date);return r!==Is?(ks=0,Is=r):r+"."+_s(ks++)}for(;Dt<Dr;Dt++)Ka[Rs[Dt]]=Dt;function Ut(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function Ps(r){let e={},t=r.split("&");for(let n=0,s=t.length;n<s;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}var Ls=!1;try{Ls=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Os=Ls;function Mr(r){let e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Os))return new XMLHttpRequest}catch{}if(!e)try{return new P[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Ya(){}var Ga=function(){return new Mr({xdomain:!1}).responseType!=null}(),Vt=class extends ge{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){let n=location.protocol==="https:",s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==n}let t=e&&e.forceBase64;this.supportsBinary=Ga&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Ts(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,As(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{},t=this.opts.secure?"https":"http",n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Mt()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);let s=Ut(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new W(this.uri(),e)}doWrite(e,t){let n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}},W=class extends C{constructor(e,t){super(),te(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){let e=Ft(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;let t=this.xhr=new Mr(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document<"u"&&(this.index=W.requestsCount++,W.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Ya,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete W.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};W.requestsCount=0;W.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ns);else if(typeof addEventListener=="function"){let r="onpagehide"in P?"pagehide":"unload";addEventListener(r,Ns,!1)}}function Ns(){for(let r in W.requests)W.requests.hasOwnProperty(r)&&W.requests[r].abort()}var tt=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),rt=P.WebSocket||P.MozWebSocket,qt=!0,Bs="arraybuffer";var Fs=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",zt=class extends ge{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,n=Fs?{}:Ft(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=qt&&!Fs?t?new rt(e,t):new rt(e):new rt(e,t,n)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType||Bs,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let n=e[t],s=t===e.length-1;Nt(n,this.supportsBinary,o=>{let i={};qt||(n.options&&(i.compress=n.options.compress),this.opts.perMessageDeflate&&(typeof o=="string"?Buffer.byteLength(o):o.length)<this.opts.perMessageDeflate.threshold&&(i.compress=!1));try{qt?this.ws.send(o):this.ws.send(o,i)}catch{}s&&tt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Mt()),this.supportsBinary||(e.b64=1);let s=Ut(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}check(){return!!rt}};var Ur={websocket:zt,polling:Vt};var Xa=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ja=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function De(r){let e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let s=Xa.exec(r||""),o={},i=14;for(;i--;)o[Ja[i]]=s[i]||"";return t!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Qa(o,o.path),o.queryKey=Za(o,o.query),o}function Qa(r,e){let t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Za(r,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,o){s&&(t[s]=o)}),t}var D=class extends C{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=De(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=De(t.host).host),te(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ps(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=Br,t.transport=e,this.id&&(t.sid=this.id);let n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Ur[e](n)}open(){let e;if(this.opts.rememberUpgrade&&D.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;D.priorWebsocketSuccess=!1;let s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!n)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;D.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function o(){n||(n=!0,c(),t.close(),t=null)}let i=h=>{let d=new Error("probe error: "+h);d.transport=t.name,o(),this.emitReserved("upgradeError",d)};function a(){i("transport closed")}function l(){i("socket closed")}function g(h){t&&h.name!==t.name&&o()}let c=()=>{t.removeListener("open",s),t.removeListener("error",i),t.removeListener("close",a),this.off("close",l),this.off("upgrading",g)};t.once("open",s),t.once("error",i),t.once("close",a),this.once("close",l),this.once("upgrading",g),t.open()}onOpen(){if(this.readyState="open",D.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){let s=this.writeBuffer[n].data;if(s&&(t+=Ss(s)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,s){if(typeof t=="function"&&(s=t,t=void 0),typeof n=="function"&&(s=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;let o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){D.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],n=0,s=e.length;for(;n<s;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};D.protocol=Br;var sf=D.protocol;function Ds(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=De(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}var Wr={};O(Wr,{Decoder:()=>ot,Encoder:()=>zr,PacketType:()=>w,protocol:()=>qs});var ec=typeof ArrayBuffer=="function",tc=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Ms=Object.prototype.toString,rc=typeof Blob=="function"||typeof Blob<"u"&&Ms.call(Blob)==="[object BlobConstructor]",nc=typeof File=="function"||typeof File<"u"&&Ms.call(File)==="[object FileConstructor]";function st(r){return ec&&(r instanceof ArrayBuffer||tc(r))||rc&&r instanceof Blob||nc&&r instanceof File}function nt(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(nt(r[t]))return!0;return!1}if(st(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return nt(r.toJSON(),!0);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&nt(r[t]))return!0;return!1}function Us(r){let e=[],t=r.data,n=r;return n.data=Vr(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Vr(r,e){if(!r)return r;if(st(r)){let t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=Vr(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){let t={};for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=Vr(r[n],e));return t}return r}function Vs(r,e){return r.data=qr(r.data,e),delete r.attachments,r}function qr(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=qr(r[t],e);else if(typeof r=="object")for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=qr(r[t],e));return r}var qs=5,w;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(w||(w={}));var zr=class{constructor(e){this.replacer=e}encode(e){return(e.type===w.EVENT||e.type===w.ACK)&&nt(e)?this.encodeAsBinary({type:e.type===w.EVENT?w.BINARY_EVENT:w.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===w.BINARY_EVENT||e.type===w.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=Us(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}},ot=class extends C{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let n=t.type===w.BINARY_EVENT;n||t.type===w.BINARY_ACK?(t.type=n?w.EVENT:w.ACK,this.reconstructor=new $r(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(st(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,n={type:Number(e.charAt(0))};if(w[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===w.BINARY_EVENT||n.type===w.BINARY_ACK){let o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let i=e.substring(o,t);if(i!=Number(i)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(i)}if(e.charAt(t+1)==="/"){let o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(o,t)}else n.nsp="/";let s=e.charAt(t+1);if(s!==""&&Number(s)==s){let o=t+1;for(;++t;){let i=e.charAt(t);if(i==null||Number(i)!=i){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){let o=this.tryParse(e.substr(t));if(ot.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case w.CONNECT:return typeof t=="object";case w.DISCONNECT:return t===void 0;case w.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case w.EVENT:case w.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case w.ACK:case w.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},$r=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=Vs(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function M(r,e,t){return r.on(e,t),function(){r.off(e,t)}}var sc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Me=class extends C{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[M(e,"open",this.onopen.bind(this)),M(e,"packet",this.onpacket.bind(this)),M(e,"error",this.onerror.bind(this)),M(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(sc.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let n={type:w.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let i=this.ids++,a=t.pop();this._registerAckCallback(i,a),n.id=i}let s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;let s=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}let o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===e&&this.sendBuffer.splice(i,1);t.call(this,new Error("operation has timed out"))},s);this.acks[e]=(...i)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...i])}}emitWithAck(e,...t){let n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((s,o)=>{t.push((i,a)=>n?i?o(i):s(a):s(i)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...o)=>n!==this._queue[0]?void 0:(s!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:w.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case w.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case w.EVENT:case w.BINARY_EVENT:this.onevent(e);break;case w.ACK:case w.BINARY_ACK:this.onack(e);break;case w.DISCONNECT:this.ondisconnect();break;case w.CONNECT_ERROR:this.destroy();let n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,n=!1;return function(...s){n||(n=!0,t.packet({type:w.ACK,id:e,data:s}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:w.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let n of t)n.apply(this,e.data)}}};function ye(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}ye.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};ye.prototype.reset=function(){this.attempts=0};ye.prototype.setMin=function(r){this.ms=r};ye.prototype.setMax=function(r){this.max=r};ye.prototype.setJitter=function(r){this.jitter=r};var Ue=class extends C{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,te(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new ye({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let s=t.parser||Wr;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new D(this.uri,this.opts);let t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let s=M(t,"open",function(){n.onopen(),e&&e()}),o=M(t,"error",i=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",i),e?e(i):n.maybeReconnectOnOpen()});if(this._timeout!==!1){let i=this._timeout;i===0&&s();let a=this.setTimeoutFn(()=>{s(),t.close(),t.emit("error",new Error("timeout"))},i);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(M(e,"ping",this.onping.bind(this)),M(e,"data",this.ondata.bind(this)),M(e,"error",this.onerror.bind(this)),M(e,"close",this.onclose.bind(this)),M(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){tt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Me(this,e,t),this.nsps[e]=n),n}_destroy(e){let t=Object.keys(this.nsps);for(let n of t)if(this.nsps[n].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var it={};function at(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};let t=Ds(r,e.path||"/socket.io"),n=t.source,s=t.id,o=t.path,i=it[s]&&o in it[s].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||i,l;return a?l=new Ue(n,e):(it[s]||(it[s]=new Ue(n,e)),l=it[s]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(at,{Manager:Ue,Socket:Me,io:at,connect:at});function he(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var we=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},re,Y=class extends EventTarget{constructor(){super(...arguments),re.set(this,new Map)}listenerCount(e){let t=we(this,re,"f").get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let s=we(this,re,"f").get(e);s==null&&(s=[],we(this,re,"f").set(e,s)),s.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let s=we(this,re,"f").get(e);s!=null&&(s=s.filter(({callback:o})=>o!==t),we(this,re,"f").set(e,s))}dispatchEvent(e){let t=super.dispatchEvent(e),n=we(this,re,"f").get(e.type);return n==null||(n=n.filter(({once:s})=>!s),we(this,re,"f").set(e.type,n)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new x(e,t))}};re=new WeakMap;var jr=class extends Event{constructor(e,t){super(e,t),this.detail=t?.detail}},x=globalThis.CustomEvent??jr;var ct=N(Se(),1),Gs=N($t(),1);var Wt=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},Ve=class{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Wt(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Wt(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};function $s(r={}){return ic(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function ic(r,e){e=e??{};let t=e.onEnd,n=new Ve,s,o,i,a=async()=>n.isEmpty()?i?{done:!0}:await new Promise((f,b)=>{o=A=>{o=null,n.push(A);try{f(r(n))}catch(_){b(_)}return s}}):r(n),l=f=>o!=null?o(f):(n.push(f),s),g=f=>(n=new Ve,o!=null?o({error:f}):(n.push({error:f}),s)),c=f=>{if(i)return s;if(e?.objectMode!==!0&&f?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:f})},h=f=>i?s:(i=!0,f!=null?g(f):l({done:!0})),d=()=>(n=new Ve,h(),{done:!0}),y=f=>(h(f),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:a,return:d,throw:y,push:c,end:h,get readableLength(){return n.size}},t==null)return s;let p=s;return s={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(f){return p.throw(f),t!=null&&(t(f),t=void 0),{done:!0}},return(){return p.return(),t!=null&&(t(),t=void 0),{done:!0}},push:c,end(f){return p.end(f),t!=null&&(t(f),t=void 0),s},get readableLength(){return p.readableLength}},s}var js=N(Se(),1);var Ws=64*1024,ac=5*1e3,jt=class{constructor(e,t){this.label=e.label,this.open=he(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,typeof this.channel.bufferedAmountLowThreshold=="number"&&(this.channel.bufferedAmountLowThreshold=Ws),e.addEventListener("message",s=>{t.onMessage(s)}),e.addEventListener("bufferedamountlow",()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()}),e.addEventListener("open",()=>{this.open.resolve(),t.onOpen()}),e.addEventListener("close",()=>{t.onClose()}),e.addEventListener("error",s=>{if(s.error?.message==="Transport channel closed")return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,s.error?.message,s.error?.errorDetail);let o=s.error instanceof Error?s.error:new Error(`datachannel error: ${s.error?.message} ${s.error?.errorDetail}`);t.onError((0,js.default)(o,"ERR_DATA_CHANNEL"))});let n=!1;this.closingInterval=setInterval(()=>{e.readyState==="closing"?(n&&t.onClose(),n=!0):n=!1},ac)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>Ws&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=he())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}};var Xs=N(Yr(),1),lc={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};function hc(){if(typeof globalThis>"u")throw(0,ct.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");let r={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(r.RTCPeerConnection==null)throw(0,ct.default)(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return r}var be=class extends Y{constructor(e){super(),this.id=e.id??S((0,Gs.default)(4),"hex").slice(0,7),this.log=$(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??hc(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},lc,e.peerConnectionConfig)),this.closed=!1,this.connected=he(),this.source=$s(),this.sink=async t=>{if(await this.connected.promise,this.channel==null)throw(0,ct.default)(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(let n of t)await this.channel.send(n);await this.close()}}handleDataChannelEvent(e){let t=e.channel;if(t==null){this.close((0,ct.default)(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch(n=>{this.log("Error closing after event channel was found to be null",n)});return}this.channel=new jt(t,{log:this.log,onMessage:n=>{this.source.push(new Uint8Array(n.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new x("ready"))},onClose:()=>{this.close().catch(n=>{this.log("error closing connection after channel close",n)})},onError:n=>{this.close(n).catch(s=>{this.log("error closing connection after channel error",s)})}})}async close(e){if(this.closed=!0,e==null&&this.channel!=null)for(;this.channel.bufferedAmount>0;)await(0,Xs.default)(100);this.channel?.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new x("close"))}};var Js=N(Se(),1),qe=class extends Y{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch(t=>{this.log.error("could not renegotiate %o",t)})})}async handleSignal(e){if(this.log('incoming signal "%s"',e.type),e.type==="offer")return await this.handleOffer(e);if(e.type==="answer")return await this.handleAnswer(e);if(e.type==="candidate")return await this.handleCandidate(e);if(e.type==="renegotiate")return await this.handleRenegotiate(e);if(e.type==="goodbye")return await this.handleGoodye(e);this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){let t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(n){if(t.address==null||t.address.endsWith(".local"))this.log("ignoring unsupported ICE candidate.");else throw(0,Js.default)(n,"ERR_ADD_ICE_CANDIDATE")}}};var Qs=$("libp2p:webrtc-peer:receiver"),lt=class extends be{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new Gr({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",t=>this.dispatchEvent(new x("signal",{detail:t.detail}))),this.peerConnection.addEventListener("datachannel",t=>{this.handleDataChannelEvent(t)})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},Gr=class extends qe{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){Qs.trace("renegotiate"),this.dispatchEvent(new x("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(let n of this.iceCandidates)await this.handleCandidate(n);this.iceCandidates=[];let t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),Qs.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new x("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){if(this.peerConnection.remoteDescription==null||this.peerConnection.remoteDescription.type==null){this.iceCandidates.push(e);return}await super.handleCandidate(e)}};var ro=N($t(),1);var Ht=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Xr=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},Zs=r=>globalThis.DOMException===void 0?new Xr(r):new DOMException(r),eo=r=>{let e=r.reason===void 0?Zs("This operation was aborted."):r.reason;return e instanceof Error?e:Zs(e)};function Jr(r,e,t,n){let s,o=new Promise((i,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){i(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:l}=n;l.aborted&&a(eo(l)),l.addEventListener("abort",()=>{a(eo(l))})}s=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{i(t())}catch(c){a(c)}return}let l=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,g=t instanceof Error?t:new Ht(l);typeof r.cancel=="function"&&r.cancel(),a(g)},e),(async()=>{try{i(await r)}catch(l){a(l)}finally{n.customTimers.clearTimeout.call(void 0,s)}})()});return o.clear=()=>{clearTimeout(s),s=void 0},o}var uc=r=>{let e=r.on||r.addListener||r.addEventListener,t=r.off||r.removeListener||r.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function fc(r,e,t){let n,s=new Promise((o,i)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");let a=[e].flat(),l=[],{addListener:g,removeListener:c}=uc(r),h=(...y)=>{let p=t.multiArgs?y:y[0];t.filter&&!t.filter(p)||(l.push(p),t.count===l.length&&(n(),o(l)))},d=y=>{n(),i(y)};n=()=>{for(let y of a)c(y,h);for(let y of t.rejectionEvents)c(y,d)};for(let y of a)g(y,h);for(let y of t.rejectionEvents)g(y,d);t.resolveImmediately&&o(l)});if(s.cancel=n,typeof t.timeout=="number"){let o=Jr(s,t.timeout);return o.cancel=n,o}return s}function to(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};let n=fc(r,e,t),s=n.then(o=>o[0]);return s.cancel=n.cancel,s}var no=N(Yr(),1);var Qr=$("libp2p:webrtc-peer:initator"),dc=1e3,ht=class extends be{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??S((0,ro.default)(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new Zr({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",t=>{this.dispatchEvent(new x("signal",{detail:t.detail}))})}handleSignal(e){this.handshake.handleSignal(e).catch(t=>{this.log("error handling signal %o %o",e,t)})}},Zr=class extends qe{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",t=>{if(t.candidate==null)return;let n={type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}};Qr.trace("create candidate",n),this.dispatchEvent(new x("signal",{detail:n})),this.dispatchEvent(new x("ice-candidate"))})}async handleRenegotiate(){if(this.status==="negotiating"){this.log("already negotiating, queueing");return}this.status="negotiating";let e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await to(this,"ice-candidate"),await(0,no.default)(dc),Qr.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new x("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){Qr.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}};var en=$("libp2p:webrtc-star:socket");function Kt(r,e){let{sink:t,source:n}=r,s={remoteAddr:e.remoteAddr,async sink(o){e.signal!=null&&(o=sr(o,e.signal));try{await t(o)}catch(i){i.type!=="aborted"&&en.error(i)}},source:e.signal!=null?sr(n,e.signal):n,timeline:{open:Date.now()},async close(){if(r.closed)return;let o=Date.now(),i=setTimeout(()=>{if(s.remoteAddr!=null){let{host:a,port:l}=s.remoteAddr.toOptions();en("timeout closing socket to %s:%s after %dms, destroying it manually",a,l,Date.now()-o)}r.closed||r.close().catch(a=>{en.error("could not close socket",a)})},2e3);try{await r.close()}finally{clearTimeout(i)}}};return r.addEventListener("close",()=>{s.timeline.close==null&&(s.timeline.close=Date.now())},{once:!0}),s}function Yt(r){let e=r.toString().split("/"),t=r.protos()[1].name,n=r.protos()[2].name,s=r.stringTuples()[1][1];if(t!=="tcp"||n!=="ws"&&n!=="wss")throw new Error(`invalid multiaddr: ${r.toString()}`);if(!cs(r))return`http://${e[2]}:${e[4]}`;if(n==="ws")return`http://${e[2]}${s==null||s==="80"?"":`:${s}`}`;if(n==="wss")return`https://${e[2]}${s==null||s==="443"?"":`:${s}`}`;throw new Error("invalid multiaddr: "+r.toString())}function so(r){let e="/libp2p-webrtc-star";if(r.startsWith(e)){r=r.substring(e.length,r.length);let t=ae(r),n=t.stringTuples().filter(s=>s[0]===421)[0];if(n[1]==null)throw new Error("invalid multiaddr: "+r);t=t.decapsulate("p2p"),t=t.encapsulate("/p2p-webrtc-star"),t=t.encapsulate(`/p2p/${n[1]}`),r=t.toString()}return r}var L=$("libp2p:webrtc-star:listener"),mc={transports:["websocket"],path:"/socket.io-next/"},tn=class extends Y{constructor(e,t,n,s,o){super(),this.signallingAddr=t,this.socket=at(e,mc),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=n,this.handler=s,this.channelOptions=o,this.handleWsHandshake=this.handleWsHandshake.bind(this);let i=!1;this.socket.on("connect_error",a=>{i&&a.type==="TransportError"||this.dispatchEvent(new x("error",{detail:a}))}),this.socket.on("error",a=>{this.dispatchEvent(new x("error",{detail:a}))}),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",a=>{this.dispatchEvent(new x("peer",{detail:a}))}),this.socket.on("connect",()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),i&&this.dispatchEvent(new x("reconnect"))}),this.socket.once("connect",()=>{i=!0,this.dispatchEvent(new x("listening"))}),this.socket.on("disconnect",()=>{this.dispatchEvent(new x("disconnect"))})}_createChannel(e,t,n){let s={...this.channelOptions},o=new lt(s),i=a=>{let l=a.detail;L.error("incoming connection errored",l)};return o.addEventListener("error",i),o.addEventListener("close",()=>{o.removeEventListener("error",i)},{once:!0}),o.addEventListener("signal",a=>{let l=a.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:n,answer:!0,signal:l})}),o.addEventListener("ready",()=>{let a=Kt(o,{remoteAddr:this.signallingAddr});L("new inbound connection %s",a.remoteAddr);try{this.upgrader.upgradeInbound(a).then(l=>{L("inbound connection %s upgraded",a.remoteAddr),this.connections.push(a);let g=()=>{this.connections=this.connections.filter(c=>c!==a),this.channels.delete(e),this.pendingSignals.delete(e)};o.addEventListener("close",g,{once:!0}),this.dispatchEvent(new x("connection",{detail:l})),this.handler(l)}).catch(l=>{L.error("inbound connection failed to upgrade",l),a.close().catch(g=>{L.error("inbound connection failed to close after failing to upgrade",g)})})}catch(l){L.error("inbound connection failed to upgrade",l),a.close().catch(g=>{L.error("inbound connection failed to close after failing to upgrade",g)})}},{once:!0}),o}handleWsHandshake(e){if(L('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),e.answer===!0||e.err!=null||e.intentId==null)return;let t=e.intentId,n=this.pendingSignals.get(t);n==null&&(n=[],this.pendingSignals.set(t,n)),n.push(e);let s=this.channels.get(t);if(s==null){if(e.signal.type!=="offer"){L("handshake is not an offer and channel does not exist, buffering until we receive an offer");return}L("creating new channel to handle offer handshake"),s=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,s)}else L("channel already exists, using it to handle handshake");for(;n.length>0;){let o=n.shift();o?.signal!=null&&s.handleSignal(o.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map(async e=>{await e.close()}),...Array.from(this.channels.values()).map(async e=>{await e.close()})]),this.dispatchEvent(new x("close"))}},rn=class extends Y{constructor(e,t,n,s,o){super(),this.upgrader=e,this.handler=t,this.peerId=n,this.transport=s,this.options=o}async listen(e){if(this.listeningAddr!=null)throw(0,io.default)(new Error("listener already in use"),"ERR_ALREADY_LISTENING");let t=he();this.listeningAddr=e;let n;e.protoCodes().includes(421)?n=e:n=e.encapsulate(`/p2p/${this.peerId.toString()}`);let s=this.signallingUrl=Yt(e);L("connecting to signalling server on: %s",this.signallingUrl);let o=new tn(this.signallingUrl,n,this.upgrader,this.handler,this.options.channelOptions);o.addEventListener("error",i=>{let a=i.detail;L("error connecting to signalling server %o",a),o.close().catch(l=>{L.error("error closing server after error",l)}),t.reject(a)}),o.addEventListener("listening",()=>{L("connected to signalling server"),this.dispatchEvent(new x("listening")),t.resolve()}),o.addEventListener("peer",i=>{this.transport.peerDiscovered(i.detail)}),o.addEventListener("connection",i=>{let a=i.detail;if(a.remoteAddr==null)try{a.remoteAddr=e.decapsulateCode(421).encapsulate(`/p2p/${a.remotePeer.toString()}`)}catch(l){L.error("could not determine remote address",l)}this.dispatchEvent(new x("connection",{detail:a}))}),o.addEventListener("disconnect",()=>{this.transport.sigServers.delete(s)}),o.addEventListener("reconnect",()=>{this.transport.sigServers.set(s,o)}),this.transport.sigServers.set(this.signallingUrl,o),await t.promise}async close(){if(this.signallingUrl!=null){let e=this.transport.sigServers.get(this.signallingUrl);e!=null&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new x("close")),this.listeningAddr=void 0}getAddrs(){return this.listeningAddr!=null?[this.listeningAddr]:[]}};function ao(r,e,t,n,s){return new rn(r,e,t,n,s)}var yo=N($t(),1);var co=Symbol.for("@libp2p/peer-id");var gc=Symbol.for("nodejs.util.inspect.custom"),lo=Object.values(ie).map(r=>r.decoder).reduce((r,e)=>r.or(e),ie.identity.decoder),ho=114,uo=36,fo=37,ut=class{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[co](){return!0}toString(){return this.string==null&&(this.string=k.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return v.createV1(ho,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Le(this.multihash.bytes,e);if(typeof e=="string")return nn(e).equals(this);if(e?.multihash?.bytes!=null)return Le(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[gc](){return`PeerId(${this.toString()})`}},ft=class extends ut{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}},dt=class extends ut{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}},pt=class extends ut{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}};function nn(r,e){if(e=e??lo,r.charAt(0)==="1"||r.charAt(0)==="Q"){let t=fe(k.decode(`z${r}`));return r.startsWith("12D")?new dt({multihash:t}):r.startsWith("16U")?new pt({multihash:t}):new ft({multihash:t})}return yc(lo.decode(r))}function yc(r){try{let e=fe(r);if(e.code===At.code){if(e.digest.length===uo)return new dt({multihash:e});if(e.digest.length===fo)return new pt({multihash:e})}if(e.code===Ct.code)return new ft({multihash:e})}catch{return wc(v.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function wc(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==ho)throw new Error("Supplied PeerID CID is invalid");let e=r.multihash;if(e.code===Ct.code)return new ft({multihash:r.multihash});if(e.code===At.code){if(e.digest.length===uo)return new dt({multihash:r.multihash});if(e.digest.length===fo)return new pt({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}var mo=Symbol.for("@libp2p/transport");var po;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(po||(po={}));var go=Symbol.for("@libp2p/peer-discovery");var vc="RTCPeerConnection"in globalThis,ve=$("libp2p:webrtc-star"),xc=()=>{},sn=class extends Y{constructor(){super(...arguments),this.started=!1}get[go](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return this.isStarted()?super.dispatchEvent(e):!1}},Gt=class{constructor(e){e?.wrtc!=null&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new sn,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[mo](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){let n=await this._connect(e,t),s=Kt(n,{remoteAddr:e,signal:t.signal});ve("new outbound connection %s",s.remoteAddr);let o=await t.upgrader.upgradeOutbound(s);return ve("outbound connection %s upgraded",s.remoteAddr),o}async _connect(e,t){if(t.signal?.aborted===!0)throw new se;let n={...t.channelOptions??{}};this.wrtc!=null&&(n.wrtc=this.wrtc);let s=e.toOptions(),o=S((0,yo.default)(36),"hex");return await new Promise((i,a)=>{let l=this.sigServers.get(Yt(e));if(l?.socket==null){a((0,mt.default)(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));return}let g=!1;ve("dialing %s:%s",s.host,s.port);let c=new ht(n),h=f=>{let b=f.detail;if(!g){let A=`connection error ${s.host}:${s.port}: ${b.message}`;ve.error(A),p(b)}},d=()=>{g=!0,ve("connection opened %s:%s",s.host,s.port),p()},y=()=>{ve.error("connection aborted %s:%s",s.host,s.port),c.close().finally(()=>{p(new se)})},p=f=>{c.removeEventListener("ready",d),t.signal?.removeEventListener("abort",y),f==null?i(c):a(f)};c.addEventListener("ready",d,{once:!0}),c.addEventListener("close",()=>{c.removeEventListener("error",h)}),t.signal?.addEventListener("abort",y),c.addEventListener("signal",f=>{let b=f.detail;l.socket.emit("ss-handshake",{intentId:o,srcMultiaddr:l.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:b})}),l.socket.on("ws-handshake",f=>{f.intentId===o&&f.err!=null&&c.close().finally(()=>{a((0,mt.default)(new Error(f.err),"ERR_SIGNALLING_FAILED"))}),!(f.intentId!==o||f.answer==null||c.closed)&&c.handleSignal(f.signal)})})}createListener(e){if(!vc&&this.wrtc==null)throw(0,mt.default)(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},this.wrtc!=null&&(e.channelOptions.wrtc=this.wrtc),this.peerId==null)throw(0,mt.default)(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return ao(e.upgrader,e.handler??xc,this.peerId,this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>t.protoCodes().includes(290)?!1:Ot.matches(t))}peerDiscovered(e){ve("peer discovered: %s",e),e=so(e);let t=ae(e),n=t.getPeerId();if(n==null)return;let s=nn(n);this._discovery.dispatchEvent(new x("peer",{detail:{id:s,multiaddrs:[t],protocols:[]}}))}};function Ec(r={}){let e=new Gt(r);return{transport:t=>(e.peerId=t.peerId,e),discovery:e.discovery}}return Co(Cc);})();
return Libp2PWebrtcStar}));
