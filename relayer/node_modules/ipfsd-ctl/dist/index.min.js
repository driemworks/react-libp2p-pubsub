(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsdCtl = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var IpfsdCtl=(()=>{var J=Object.create;var f=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),F=(e,t)=>{for(var o in t)f(e,o,{get:t[o],enumerable:!0})},O=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of G(t))!B.call(e,n)&&n!==o&&f(e,n,{get:()=>t[n],enumerable:!(r=q(t,n))||r.enumerable});return e};var E=(e,t,o)=>(o=e!=null?J(M(e)):{},O(t||!e||!e.__esModule?f(o,"default",{value:e,enumerable:!0}):o,e)),V=e=>O(f({},"__esModule",{value:!0}),e);var x=d((it,S)=>{"use strict";S.exports=e=>{if(Object.prototype.toString.call(e)!=="[object Object]")return!1;let t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}});var k=d(($,v)=>{"use strict";var h=x(),{hasOwnProperty:A}=Object.prototype,{propertyIsEnumerable:z}=Object,p=(e,t,o)=>Object.defineProperty(e,t,{value:o,writable:!0,enumerable:!0,configurable:!0}),C=$,P={concatArrays:!1,ignoreUndefined:!1},u=e=>{let t=[];for(let o in e)A.call(e,o)&&t.push(o);if(Object.getOwnPropertySymbols){let o=Object.getOwnPropertySymbols(e);for(let r of o)z.call(e,r)&&t.push(r)}return t};function a(e){return Array.isArray(e)?H(e):h(e)?Q(e):e}function H(e){let t=e.slice(0,0);return u(e).forEach(o=>{p(t,o,a(e[o]))}),t}function Q(e){let t=Object.getPrototypeOf(e)===null?Object.create(null):{};return u(e).forEach(o=>{p(t,o,a(e[o]))}),t}var T=(e,t,o,r)=>(o.forEach(n=>{typeof t[n]>"u"&&r.ignoreUndefined||(n in e&&e[n]!==Object.getPrototypeOf(e)?p(e,n,w(e[n],t[n],r)):p(e,n,a(t[n])))}),e),X=(e,t,o)=>{let r=e.slice(0,0),n=0;return[e,t].forEach(s=>{let l=[];for(let i=0;i<s.length;i++)A.call(s,i)&&(l.push(String(i)),s===e?p(r,n++,s[i]):p(r,n++,a(s[i])));r=T(r,s,u(s).filter(i=>!l.includes(i)),o)}),r};function w(e,t,o){return o.concatArrays&&Array.isArray(e)&&Array.isArray(t)?X(e,t,o):!h(t)||!h(e)?a(t):T(e,t,u(t),o)}v.exports=function(...e){let t=w(a(P),this!==C&&this||{},P),o={_:{}};for(let r of e)if(r!==void 0){if(!h(r))throw new TypeError("`"+r+"` is not an Option Object");o=w(o,{_:r},t)}return o._}});var U=d((pt,_)=>{function Y(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}_.exports=Y});var rt={};F(rt,{createFactory:()=>I,createNode:()=>et,createServer:()=>ot});var y=class{options;port;host;constructor(t={port:43134,host:"localhost"}){this.options=t,this.port=this.options.port??43134,this.host=this.options.host??"localhost",console.warn("Server not implemented in the browser")}async start(){return console.warn("Server not implemented in the browser"),this}async stop(){console.warn("Server not implemented in the browser")}},j=y;var N=E(k(),1),R=N.default;var L=E(U(),1),Z=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,K=(0,L.default)();var W=K&&!Z;var D=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!K,at=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,lt=typeof globalThis.process<"u"&&typeof globalThis.process.env<"u"&&globalThis.process.env["NODE"+"_"+"ENV"]==="test",ft=typeof navigator<"u"&&navigator.product==="ReactNative";var c=class{options;peerInfo;id;disposable;repo;endpoint;_api;initArgs;startArgs;stopArgs;constructor(t){if(t.rpc==null)throw new Error("Please pass an rpc option");this.options=t,this.endpoint=t.endpoint,this.disposable=t.disposable,this.id=t.id,this.repo=t.repo,t.init!=null&&typeof t.init!="boolean"&&(this.initArgs=t.init),t.start!=null&&typeof t.start!="boolean"&&(this.startArgs=t.start),t.stop!=null&&(this.stopArgs=t.stop)}get api(){if(this._api==null)throw new Error("Not started");return this._api}async info(){let t=await fetch(`${this.endpoint}/info?${new URLSearchParams({id:this.id})}`,{method:"GET"});if(!t.ok)throw new Error(`Error getting remote kubo info - ${await t.text()}`);return t.json()}async init(t){let o=await fetch(`${this.endpoint}/init?${new URLSearchParams({id:this.id})}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({...this.initArgs??{},...t??{}})});if(!o.ok)throw new Error(`Error initializing remote kubo - ${await o.text()}`)}async start(t){let o=await fetch(`${this.endpoint}/start?${new URLSearchParams({id:this.id})}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({...this.startArgs??{},...t??{}})});if(!o.ok)throw new Error(`Error starting remote kubo - ${await o.text()}`);let r=await o.json();this._api=this.options.rpc(r.api)}async stop(t){let o=await fetch(`${this.endpoint}/stop?${new URLSearchParams({id:this.id})}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({...this.stopArgs??{},...t??{}})});if(!o.ok)throw new Error(`Error stopping remote kubo - ${await o.text()}`);this.disposable&&await this.cleanup()}async cleanup(){let t=await fetch(`${this.endpoint}/cleanup?${new URLSearchParams({id:this.id})}`,{method:"POST"});if(!t.ok)throw new Error(`Error cleaning up remote kubo - ${await t.text()}`)}};var b=R.bind({ignoreUndefined:!0}),tt={endpoint:process.env.IPFSD_CTL_SERVER??"http://localhost:43134",remote:!D&&!W,disposable:!0,test:!1,type:"kubo",env:{},args:[],forceKill:!0,forceKillTimeout:5e3},m=class{options;controllers;overrides;constructor(t={},o={}){this.options=b({},tt,t),this.overrides=b({kubo:this.options},o),this.controllers=[]}async spawn(t){let o=t?.type??this.options.type??"kubo",r=b({},this.options,this.overrides[o],t),n;if(o==="kubo")if(r.remote===!0){let l=await(await fetch(`${r.endpoint}/spawn`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({...r,remote:!1})})).json();n=new c({...r,...l})}else n=new c(r);if(n==null)throw new Error(`Unsupported type "${o}" - configured types [${[...new Set([this.options.type,...Object.keys(this.overrides)].filter(Boolean))].join(", ")}]`);return this.controllers.push(n),r.init!==!1&&await n.init(r.init),r.start!==!1&&await n.start(r.start),n}async clean(){await Promise.all(this.controllers.map(async t=>t.stop())),this.controllers=[]}},g=m;function I(e,t){return new g(e,t)}async function et(e){return new g().spawn(e)}var ot=(e,t={},o={})=>{let r;return typeof e=="number"?r=e:e!=null&&(r=e.port),new j({port:r,host:"127.0.0.1"},I(t,o))};return V(rt);})();
return IpfsdCtl}));
